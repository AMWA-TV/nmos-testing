# Testing Controllers

## Fully Automated Controller Tests

The testing tool supports fully automated testing of Controllers by replacing the Testing Façade with your own application to receive and process the requests from the NMOS Testing Tool. A full example utilising Flask and Selenium can be found on the nmos-js repository under AutomatedTesting. 

## Building your fully automated test interface

The Testing Façade IP/Hostname and Port on the test suite should be set to the location of your application.
POST requests are sent from the Test Suite to the API endpoint '{IP/hostname}:{Port}/x-nmos/testingfacade' 

JSON schema and RAML files for both the Question and Answer API endpoints can be found in the [testingfacade folder](../testingfacade/APIs). Along with
example JSON files for each type of Question and Answer that could be sent and received in the [examples folder](../testingfacade/examples).

An example python class for storing and retrieving this data can be found at [testingfacade/DataStore.py](../testingfacade/DataStore.py)

On receiving a POST request from the Testing Tool, your application should use the question id to instruct your chosen automated test framework (eg. Selenium) to carry out the required tasks on your Controller and return appropriate answers.

Some test have multiple questions, all of which must be answered correctly to pass the test. 

There are three types of question that requires different answer formats:
- `single_choice` - return a single answer string of the answer_id from the answers dict
- `multi_choice` - return multiple answer strings of answer_id's from the answers dict in a list
- `action` - no answers given, return an empty string once the required actions have been completed

Your application should POST the answer(s) to the url given in 'answer_uri'. This POST request should contain the following data in JSON form: 
- The 'question_id' field originally received from the test suite.
- Your answer(s) in the 'answer_response' field. 
- The current time in the 'time_answered' field.  

Any other data included in the request is ignored.

The test suite will process the answer then send the next question. If no answer is received by the test suite within the timeout period, the test will expire and the first question of the next test will be sent.

The test suite begins with a pre_tests_message and ends with a post_tests_message. These should be treated as action questions and return an empty string to begin/end the actual tests.
