{
    "title": "Controller Testing - Question",
    "description": "Contains all details necessary for NMOS Controller Testing",
    "$schema": "http://json-schema.org/draft-04/schema",
    "type": "object",
    "required": [
        "test_type",
        "question_id",
        "name",
        "description",
        "question",
        "answers",
        "time_sent",
        "timeout",
        "answer_uri",
        "metadata"
    ],
    "properties": {
        "test_type": {
            "type": "string",
            "description": "The type of question being sent indicating the type of answer that needs to be returned",
            "enum": [
                "single_choice", 
                "multi_choice", 
                "action"
            ]
        },
        "question_id": {
            "description": "A unique string for each individual question sent. Where a test contains multiple questions they will share a name attribute but have a unique id.",
            "anyOf": [
                {
                    "description": "Identifier for messages sent at the beginning and end of every set of tests",
                    "type": "string",
                    "enum": [
                        "pre_tests_message",
                        "post_tests_message"
                    ]
                },
                {
                    "description": "Identifier for questions within a test",
                    "type": "string",
                    "pattern": "test_[0-9a-z_]+"
                }
            ]
        },
        "name": {
            "type": "string",
            "description": "The test name, indicating the test that sent the question",
            "pattern": "test_[0-9a-z_]+"
        },
        "description": {
            "type": "string",
            "description": "A brief description of the test"
        },
        "question": {
            "type": "string",
            "description": "Human readable question text containing instructions to carry out the test"
        },
        "answers": {
            "oneOf": [
                {
                    "type": "null",
                    "description": "Action type questions"
                },
                {
                    "type": "array",
                    "description": "Array containing answer objects to be used to select the correct answer_id to be returned.",
                    "examples": [
                        [
                            {
                                "answer_id": "answer_2",
                                "label": "s3/wright",
                                "description": "Mock sender 3",
                                "id": "71ce775c-cdc5-479a-bd29-87c081905ecf",
                                "display_answer": "s3/wright (Mock sender 3, 71ce775c-cdc5-479a-bd29-87c081905ecf)"
                            }
                        ]
                    ],
                    "items": {
                        "description": "Individual answer details, the label, description and id of the relevant resource and an associated answer_id",
                        "type": "object",
                        "required": [
                            "answer_id",
                            "label",
                            "description",
                            "id",
                            "display_answer"
                        ],
                        "properties": {
                            "answer_id": {
                                "type": "string",
                                "description": "ID unique to each answer within a question. This is the value to be returned for validation.",
                                "pattern": "answer_[0-9]+"
                            },
                            "label": {
                                "type": "string",
                                "description": "Resource label as might be displayed on the NCuT"
                            },
                            "description": {
                                "type": "string",
                                "description": "Resource description as might be displayed on the NCuT"
                            },
                            "id": {
                                "type": "string",
                                "description": "Resource ID as might be displayed on the NCuT",
                                "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"
                            },
                            "display_answer": {
                                "type": "string",
                                "description": "String combining all the resource details for display on the testing facade"
                            }
                        }
                    }
                }
            ]
        },
        "time_sent": {
            "type": "number",
            "description": "Time the question was sent, unix timestamp in seconds"
        },
        "timeout": {
            "type": "number",
            "description": "Time in seconds the test suite will wait to receive an answer to a particular question",
            "default": 600
        },
        "answer_uri": {
            "type": "string",
            "format": "uri",
            "description": "URL of the test suite API endpoint to send the POST request with answers"
        },
        "metadata": {
            "description": "Extra information to assist fully automated testing where an action is required on a specific resource",
            "default": null,
            "anyOf": [
                {
                    "type": "null"
                },
                {
                    "type": "object",
                    "properties": {
                        "sender": {
                            "$ref": "resource-details-schema.json"
                        },
                        "receiver": {
                            "$ref": "resource-details-schema.json"
                        }
                    },
                    "additionalProperties": false,
                    "minProperties": 1 
                }
            ]
        }
    }
}
